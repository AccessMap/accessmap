version: '3.2'

services:

  tippecanoe:
    entrypoint: sh /build_tiles.sh /home/tippecanoe/data https://${HOST}

  api:
    environment:
      - DATABASE_URL=${DATABASE_URL}
    restart: always

  webapp:
    environment:
      - OPENID_CLIENT_ID=AccessMapUW

  caddy:
    restart: always
    volumes:
      - ./config/Caddyfile.tls.staging:/etc/Caddyfile.tls
      - /docker/.caddy:/root/.caddy
    ports:
      - 80:80
      - 443:443
    environment:
      - HOST=$HOST
      - ANALYTICS_URL=$ANALYTICS_URL
